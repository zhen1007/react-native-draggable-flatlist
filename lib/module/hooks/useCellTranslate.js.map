{"version":3,"names":["useDerivedValue","withSpring","useAnimatedValues","useDraggableFlatListContext","useRefs","useCellTranslate","cellIndex","cellSize","cellOffset","activeIndexAnim","activeCellSize","hoverOffset","spacerIndexAnim","placeholderOffset","hoverAnim","viewableIndexMin","viewableIndexMax","activeKey","animationConfigRef","translate","isActiveCell","value","isOutsideViewableRange","isBeforeActive","isAfterActive","hoverPlusActiveSize","offsetPlusHalfSize","offsetPlusSize","result","newPlaceholderOffset","shouldTranslate","translationAmt","current"],"sources":["useCellTranslate.tsx"],"sourcesContent":["import Animated, { useDerivedValue, withSpring } from \"react-native-reanimated\";\r\nimport { useAnimatedValues } from \"../context/animatedValueContext\";\r\nimport { useDraggableFlatListContext } from \"../context/draggableFlatListContext\";\r\nimport { useRefs } from \"../context/refContext\";\r\n\r\ntype Params = {\r\n  cellIndex: number;\r\n  cellSize: Animated.SharedValue<number>;\r\n  cellOffset: Animated.SharedValue<number>;\r\n};\r\n\r\nexport function useCellTranslate({ cellIndex, cellSize, cellOffset }: Params) {\r\n  const {\r\n    activeIndexAnim,\r\n    activeCellSize,\r\n    hoverOffset,\r\n    spacerIndexAnim,\r\n    placeholderOffset,\r\n    hoverAnim,\r\n    viewableIndexMin,\r\n    viewableIndexMax,\r\n  } = useAnimatedValues();\r\n\r\n  const { activeKey } = useDraggableFlatListContext();\r\n\r\n  const { animationConfigRef } = useRefs();\r\n\r\n  const translate = useDerivedValue(() => {\r\n    const isActiveCell = cellIndex === activeIndexAnim.value;\r\n    const isOutsideViewableRange =\r\n      !isActiveCell &&\r\n      (cellIndex < viewableIndexMin.value ||\r\n        cellIndex > viewableIndexMax.value);\r\n    if (!activeKey || activeIndexAnim.value < 0 || isOutsideViewableRange) {\r\n      return 0;\r\n    }\r\n\r\n    // Determining spacer index is hard to visualize. See diagram: https://i.imgur.com/jRPf5t3.jpg\r\n    const isBeforeActive = cellIndex < activeIndexAnim.value;\r\n    const isAfterActive = cellIndex > activeIndexAnim.value;\r\n\r\n    const hoverPlusActiveSize = hoverOffset.value + activeCellSize.value;\r\n    const offsetPlusHalfSize = cellOffset.value + cellSize.value / 2;\r\n    const offsetPlusSize = cellOffset.value + cellSize.value;\r\n    let result = -1;\r\n\r\n    if (isAfterActive) {\r\n      if (\r\n        hoverPlusActiveSize >= cellOffset.value &&\r\n        hoverPlusActiveSize < offsetPlusHalfSize\r\n      ) {\r\n        // bottom edge of active cell overlaps top half of current cell\r\n        result = cellIndex - 1;\r\n      } else if (\r\n        hoverPlusActiveSize >= offsetPlusHalfSize &&\r\n        hoverPlusActiveSize < offsetPlusSize\r\n      ) {\r\n        // bottom edge of active cell overlaps bottom half of current cell\r\n        result = cellIndex;\r\n      }\r\n    } else if (isBeforeActive) {\r\n      if (\r\n        hoverOffset.value < offsetPlusSize &&\r\n        hoverOffset.value >= offsetPlusHalfSize\r\n      ) {\r\n        // top edge of active cell overlaps bottom half of current cell\r\n        result = cellIndex + 1;\r\n      } else if (\r\n        hoverOffset.value >= cellOffset.value &&\r\n        hoverOffset.value < offsetPlusHalfSize\r\n      ) {\r\n        // top edge of active cell overlaps top half of current cell\r\n        result = cellIndex;\r\n      }\r\n    }\r\n\r\n    if (result !== -1 && result !== spacerIndexAnim.value) {\r\n      spacerIndexAnim.value = result;\r\n    }\r\n\r\n    if (spacerIndexAnim.value === cellIndex) {\r\n      const newPlaceholderOffset = isAfterActive\r\n        ? cellSize.value + (cellOffset.value - activeCellSize.value)\r\n        : cellOffset.value;\r\n      placeholderOffset.value = newPlaceholderOffset;\r\n    }\r\n\r\n    // Active cell follows touch\r\n    if (isActiveCell) {\r\n      return hoverAnim.value;\r\n    }\r\n\r\n    // Translate cell down if it is before active index and active cell has passed it.\r\n    // Translate cell up if it is after the active index and active cell has passed it.\r\n\r\n    const shouldTranslate = isAfterActive\r\n      ? cellIndex <= spacerIndexAnim.value\r\n      : cellIndex >= spacerIndexAnim.value;\r\n\r\n    const translationAmt = shouldTranslate\r\n      ? activeCellSize.value * (isAfterActive ? -1 : 1)\r\n      : 0;\r\n\r\n    return withSpring(translationAmt, animationConfigRef.current);\r\n  }, [activeKey, cellIndex]);\r\n\r\n  return translate;\r\n}\r\n"],"mappings":"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"}