{"version":3,"names":["React","useRef","useState","findNodeHandle","LogBox","useDerivedValue","useSharedValue","DraggableFlatList","useSafeNestableScrollContainerContext","useNestedAutoScroll","useStableCallback","NestableDraggableFlatListInner","props","ref","hasSuppressedWarnings","current","ignoreLogs","console","reportErrorsAsExceptions","scrollableRef","outerScrollOffset","setOuterScrollEnabled","listVerticalOffset","animVals","setAnimVals","defaultHoverOffset","listHoverOffset","setListHoverOffset","hoverOffset","value","onListContainerLayout","containerRef","nodeHandle","onSuccess","_x","y","onFail","log","measureLayout","onDragBegin","params","onDragEnd","onAnimValInit","activationDistance","NestableDraggableFlatList","forwardRef"],"sources":["NestableDraggableFlatList.tsx"],"sourcesContent":["import React, { useRef, useState } from \"react\";\r\nimport { findNodeHandle, LogBox } from \"react-native\";\r\nimport Animated, {\r\n  useDerivedValue,\r\n  useSharedValue,\r\n} from \"react-native-reanimated\";\r\nimport { DraggableFlatListProps } from \"../types\";\r\nimport DraggableFlatList from \"../components/DraggableFlatList\";\r\nimport { useSafeNestableScrollContainerContext } from \"../context/nestableScrollContainerContext\";\r\nimport { useNestedAutoScroll } from \"../hooks/useNestedAutoScroll\";\r\nimport { typedMemo } from \"../utils\";\r\nimport { useStableCallback } from \"../hooks/useStableCallback\";\r\nimport { FlatList } from \"react-native-gesture-handler\";\r\n\r\nfunction NestableDraggableFlatListInner<T>(\r\n  props: DraggableFlatListProps<T>,\r\n  ref?: React.ForwardedRef<FlatList<T>>\r\n) {\r\n  const hasSuppressedWarnings = useRef(false);\r\n\r\n  if (!hasSuppressedWarnings.current) {\r\n    LogBox.ignoreLogs([\r\n      \"VirtualizedLists should never be nested inside plain ScrollViews with the same orientation because it can break windowing\",\r\n    ]); // Ignore log notification by message\r\n    //@ts-ignore\r\n    console.reportErrorsAsExceptions = false;\r\n    hasSuppressedWarnings.current = true;\r\n  }\r\n\r\n  const {\r\n    scrollableRef,\r\n    outerScrollOffset,\r\n    setOuterScrollEnabled,\r\n  } = useSafeNestableScrollContainerContext();\r\n\r\n  const listVerticalOffset = useSharedValue(0);\r\n  const [animVals, setAnimVals] = useState({});\r\n  const defaultHoverOffset = useSharedValue(0);\r\n  const [listHoverOffset, setListHoverOffset] = useState(defaultHoverOffset);\r\n\r\n  const hoverOffset = useDerivedValue(() => {\r\n    return listHoverOffset.value + listVerticalOffset.value;\r\n  }, [listHoverOffset]);\r\n\r\n  useNestedAutoScroll({\r\n    ...animVals,\r\n    hoverOffset,\r\n  });\r\n\r\n  const onListContainerLayout = useStableCallback(async ({ containerRef }) => {\r\n    const nodeHandle = findNodeHandle(scrollableRef.current);\r\n\r\n    const onSuccess = (_x: number, y: number) => {\r\n      listVerticalOffset.value = y;\r\n    };\r\n    const onFail = () => {\r\n      console.log(\"## nested draggable list measure fail\");\r\n    };\r\n    //@ts-ignore\r\n    containerRef.current.measureLayout(nodeHandle, onSuccess, onFail);\r\n  });\r\n\r\n  const onDragBegin: DraggableFlatListProps<T>[\"onDragBegin\"] = useStableCallback(\r\n    (params) => {\r\n      setOuterScrollEnabled(false);\r\n      props.onDragBegin?.(params);\r\n    }\r\n  );\r\n\r\n  const onDragEnd: DraggableFlatListProps<T>[\"onDragEnd\"] = useStableCallback(\r\n    (params) => {\r\n      setOuterScrollEnabled(true);\r\n      props.onDragEnd?.(params);\r\n    }\r\n  );\r\n\r\n  const onAnimValInit: DraggableFlatListProps<T>[\"onAnimValInit\"] = useStableCallback(\r\n    (params) => {\r\n      setListHoverOffset(params.hoverOffset);\r\n      setAnimVals({\r\n        ...params,\r\n        hoverOffset,\r\n      });\r\n      props.onAnimValInit?.(params);\r\n    }\r\n  );\r\n\r\n  return (\r\n    <DraggableFlatList\r\n      ref={ref}\r\n      onContainerLayout={onListContainerLayout}\r\n      activationDistance={props.activationDistance || 20}\r\n      scrollEnabled={false}\r\n      {...props}\r\n      outerScrollOffset={outerScrollOffset}\r\n      onDragBegin={onDragBegin}\r\n      onDragEnd={onDragEnd}\r\n      onAnimValInit={onAnimValInit}\r\n    />\r\n  );\r\n}\r\n\r\n// Generic forwarded ref type assertion taken from:\r\n// https://fettblog.eu/typescript-react-generic-forward-refs/#option-1%3A-type-assertion\r\nexport const NestableDraggableFlatList = React.forwardRef(\r\n  NestableDraggableFlatListInner\r\n) as <T>(\r\n  props: DraggableFlatListProps<T> & { ref?: React.ForwardedRef<FlatList<T>> }\r\n) => ReturnType<typeof NestableDraggableFlatListInner>;\r\n"],"mappings":"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"}