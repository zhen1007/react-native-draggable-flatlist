{"version":3,"names":["AnimatedFlatList","Animated","createAnimatedComponent","FlatList","DraggableFlatListInner","props","useRefs","cellDataRef","containerRef","flatlistRef","keyToIndexRef","propsRef","animationConfigRef","useAnimatedValues","activeCellOffset","activeCellSize","activeIndexAnim","containerSize","scrollOffset","scrollViewSize","spacerIndexAnim","horizontalAnim","placeholderOffset","touchTranslate","autoScrollDistance","panGestureState","isTouchActiveNative","viewableIndexMin","viewableIndexMax","disabled","reset","useStableCallback","value","setActiveKey","dragHitSlop","DEFAULT_PROPS","scrollEnabled","activationDistance","activationDistanceProp","useState","activeKey","current","enableLayoutAnimationExperimental","layoutAnimationDisabled","setLayoutAnimationDisabled","keyExtractor","item","index","Error","dataRef","useRef","data","dataHasChanged","map","join","useEffect","setTimeout","useLayoutEffect","forEach","d","i","key","set","drag","get","cellData","measurements","offset","size","onDragBegin","undefined","onContainerLayout","layout","nativeEvent","width","height","horizontal","onListContentSizeChange","w","h","onContentSizeChange","onContainerTouchStart","onContainerTouchEnd","extraData","useMemo","renderItem","useCallback","onRelease","onDragEnd","from","to","newData","splice","onPlaceholderIndexChange","useAnimatedReaction","cur","prev","hasMoved","runOnJS","gestureDisabled","useSharedValue","panGesture","Gesture","Pan","onBegin","evt","state","onUpdate","translation","translationX","translationY","onEnd","springTo","withSpring","onTouchesDown","onTouchesUp","hitSlop","activeOffset","activeOffsetX","activeOffsetY","onScroll","onScrollOffsetChange","scrollHandler","useAnimatedScrollHandler","contentOffset","x","y","useAutoScroll","onViewableItemsChanged","info","viewableIndices","viewableItems","filter","isViewable","min","Math","max","containerStyle","renderPlaceholder","CellRendererComponent","simultaneousHandlers","DraggableFlatList","ref","MemoizedInner","typedMemo","React","forwardRef"],"sources":["DraggableFlatList.tsx"],"sourcesContent":["import React, {\r\n  useCallback,\r\n  useEffect,\r\n  useLayoutEffect,\r\n  useMemo,\r\n  useRef,\r\n  useState,\r\n} from \"react\";\r\nimport { ListRenderItem, FlatListProps, LayoutChangeEvent } from \"react-native\";\r\nimport {\r\n  FlatList,\r\n  Gesture,\r\n  GestureDetector,\r\n} from \"react-native-gesture-handler\";\r\nimport Animated, {\r\n  runOnJS,\r\n  useAnimatedReaction,\r\n  useAnimatedScrollHandler,\r\n  useSharedValue,\r\n  withSpring,\r\n} from \"react-native-reanimated\";\r\nimport CellRendererComponent from \"./CellRendererComponent\";\r\nimport { DEFAULT_PROPS, isWeb } from \"../constants\";\r\nimport PlaceholderItem from \"./PlaceholderItem\";\r\nimport RowItem from \"./RowItem\";\r\nimport { DraggableFlatListProps } from \"../types\";\r\nimport PropsProvider from \"../context/propsContext\";\r\nimport AnimatedValueProvider, {\r\n  useAnimatedValues,\r\n} from \"../context/animatedValueContext\";\r\nimport RefProvider, { useRefs } from \"../context/refContext\";\r\nimport DraggableFlatListProvider from \"../context/draggableFlatListContext\";\r\nimport { useAutoScroll } from \"../hooks/useAutoScroll\";\r\nimport { useStableCallback } from \"../hooks/useStableCallback\";\r\nimport ScrollOffsetListener from \"./ScrollOffsetListener\";\r\nimport { typedMemo } from \"../utils\";\r\n\r\ntype RNGHFlatListProps<T> = Animated.AnimateProps<\r\n  FlatListProps<T> & {\r\n    ref: React.Ref<FlatList<T>>;\r\n    simultaneousHandlers?: React.Ref<any> | React.Ref<any>[];\r\n  }\r\n>;\r\n\r\ntype OnViewableItemsChangedCallback<T> = Exclude<\r\n  FlatListProps<T>[\"onViewableItemsChanged\"],\r\n  undefined | null\r\n>;\r\n\r\nconst AnimatedFlatList = (Animated.createAnimatedComponent(\r\n  FlatList\r\n) as unknown) as <T>(props: RNGHFlatListProps<T>) => React.ReactElement;\r\n\r\nfunction DraggableFlatListInner<T>(props: DraggableFlatListProps<T>) {\r\n  const {\r\n    cellDataRef,\r\n    containerRef,\r\n    flatlistRef,\r\n    keyToIndexRef,\r\n    propsRef,\r\n    animationConfigRef,\r\n  } = useRefs<T>();\r\n  const {\r\n    activeCellOffset,\r\n    activeCellSize,\r\n    activeIndexAnim,\r\n    containerSize,\r\n    scrollOffset,\r\n    scrollViewSize,\r\n    spacerIndexAnim,\r\n    horizontalAnim,\r\n    placeholderOffset,\r\n    touchTranslate,\r\n    autoScrollDistance,\r\n    panGestureState,\r\n    isTouchActiveNative,\r\n    viewableIndexMin,\r\n    viewableIndexMax,\r\n    disabled,\r\n  } = useAnimatedValues();\r\n\r\n  const reset = useStableCallback(() => {\r\n    activeIndexAnim.value = -1;\r\n    spacerIndexAnim.value = -1;\r\n    touchTranslate.value = 0;\r\n    activeCellSize.value = -1;\r\n    activeCellOffset.value = -1;\r\n    setActiveKey(null);\r\n  });\r\n\r\n  const {\r\n    dragHitSlop = DEFAULT_PROPS.dragHitSlop,\r\n    scrollEnabled = DEFAULT_PROPS.scrollEnabled,\r\n    activationDistance: activationDistanceProp = DEFAULT_PROPS.activationDistance,\r\n  } = props;\r\n\r\n  let [activeKey, setActiveKey] = useState<string | null>(null);\r\n  const [layoutAnimationDisabled, setLayoutAnimationDisabled] = useState(\r\n    !propsRef.current.enableLayoutAnimationExperimental\r\n  );\r\n\r\n  const keyExtractor = useStableCallback((item: T, index: number) => {\r\n    if (!props.keyExtractor) {\r\n      throw new Error(\"You must provide a keyExtractor to DraggableFlatList\");\r\n    }\r\n    return props.keyExtractor(item, index);\r\n  });\r\n\r\n  const dataRef = useRef(props.data);\r\n  const dataHasChanged =\r\n    dataRef.current.map(keyExtractor).join(\"\") !==\r\n    props.data.map(keyExtractor).join(\"\");\r\n  dataRef.current = props.data;\r\n  if (dataHasChanged) {\r\n    // When data changes make sure `activeKey` is nulled out in the same render pass\r\n    activeKey = null;\r\n  }\r\n\r\n  useEffect(() => {\r\n    if (!propsRef.current.enableLayoutAnimationExperimental) return;\r\n    if (activeKey) {\r\n      setLayoutAnimationDisabled(true);\r\n    } else {\r\n      // setTimeout result of trial-and-error to determine how long to wait before\r\n      // re-enabling layout animations so that a drag reorder does not trigger it.\r\n      setTimeout(() => {\r\n        setLayoutAnimationDisabled(false);\r\n      }, 100);\r\n    }\r\n  }, [activeKey]);\r\n\r\n  useLayoutEffect(() => {\r\n    props.data.forEach((d, i) => {\r\n      const key = keyExtractor(d, i);\r\n      keyToIndexRef.current.set(key, i);\r\n    });\r\n  }, [props.data, keyExtractor, keyToIndexRef]);\r\n\r\n  const drag = useStableCallback((activeKey: string) => {\r\n    if (disabled.value) return;\r\n    const index = keyToIndexRef.current.get(activeKey);\r\n    const cellData = cellDataRef.current.get(activeKey);\r\n    if (cellData) {\r\n      activeCellOffset.value = cellData.measurements.offset;\r\n      activeCellSize.value = cellData.measurements.size;\r\n    }\r\n\r\n    const { onDragBegin } = propsRef.current;\r\n    if (index !== undefined) {\r\n      spacerIndexAnim.value = index;\r\n      activeIndexAnim.value = index;\r\n      setActiveKey(activeKey);\r\n      onDragBegin?.(index);\r\n    }\r\n  });\r\n\r\n  const onContainerLayout = ({\r\n    nativeEvent: { layout },\r\n  }: LayoutChangeEvent) => {\r\n    const { width, height } = layout;\r\n    containerSize.value = props.horizontal ? width : height;\r\n    props.onContainerLayout?.({ layout, containerRef });\r\n  };\r\n\r\n  const onListContentSizeChange = (w: number, h: number) => {\r\n    scrollViewSize.value = props.horizontal ? w : h;\r\n    props.onContentSizeChange?.(w, h);\r\n  };\r\n\r\n  const onContainerTouchStart = () => {\r\n    if (!disabled.value) {\r\n      isTouchActiveNative.value = true;\r\n    }\r\n    return false;\r\n  };\r\n\r\n  const onContainerTouchEnd = () => {\r\n    isTouchActiveNative.value = false;\r\n  };\r\n\r\n  const extraData = useMemo(\r\n    () => ({\r\n      activeKey,\r\n      extraData: props.extraData,\r\n    }),\r\n    [activeKey, props.extraData]\r\n  );\r\n\r\n  const renderItem: ListRenderItem<T> = useCallback(\r\n    ({ item, index }) => {\r\n      const key = keyExtractor(item, index);\r\n      if (index !== keyToIndexRef.current.get(key)) {\r\n        keyToIndexRef.current.set(key, index);\r\n      }\r\n\r\n      return (\r\n        <RowItem\r\n          item={item}\r\n          itemKey={key}\r\n          renderItem={props.renderItem}\r\n          drag={drag}\r\n          extraData={props.extraData}\r\n        />\r\n      );\r\n    },\r\n    [props.renderItem, props.extraData, drag, keyExtractor]\r\n  );\r\n\r\n  const onRelease = useStableCallback((index: number) => {\r\n    props.onRelease?.(index);\r\n  });\r\n\r\n  const onDragEnd = useStableCallback(\r\n    ({ from, to }: { from: number; to: number }) => {\r\n      const { onDragEnd, data } = props;\r\n\r\n      const newData = [...data];\r\n      if (from !== to) {\r\n        newData.splice(from, 1);\r\n        newData.splice(to, 0, data[from]);\r\n      }\r\n\r\n      onDragEnd?.({ from, to, data: newData });\r\n      reset();\r\n    }\r\n  );\r\n\r\n  const onPlaceholderIndexChange = useStableCallback((index: number) => {\r\n    props.onPlaceholderIndexChange?.(index);\r\n  });\r\n\r\n  // Handle case where user ends drag without moving their finger.\r\n  useAnimatedReaction(\r\n    () => {\r\n      return isTouchActiveNative.value;\r\n    },\r\n    (cur, prev) => {\r\n      if (cur !== prev && !cur) {\r\n        const hasMoved = !!touchTranslate.value;\r\n        if (!hasMoved && activeIndexAnim.value >= 0 && !disabled.value) {\r\n          runOnJS(onRelease)(activeIndexAnim.value);\r\n          runOnJS(onDragEnd)({\r\n            from: activeIndexAnim.value,\r\n            to: spacerIndexAnim.value,\r\n          });\r\n        }\r\n      }\r\n    },\r\n    [isTouchActiveNative, onDragEnd, onRelease]\r\n  );\r\n\r\n  useAnimatedReaction(\r\n    () => {\r\n      return spacerIndexAnim.value;\r\n    },\r\n    (cur, prev) => {\r\n      if (prev !== null && cur !== prev && cur >= 0 && prev >= 0) {\r\n        runOnJS(onPlaceholderIndexChange)(cur);\r\n      }\r\n    },\r\n    [spacerIndexAnim]\r\n  );\r\n\r\n  const gestureDisabled = useSharedValue(false);\r\n\r\n  const panGesture = Gesture.Pan()\r\n    .onBegin((evt) => {\r\n      gestureDisabled.value = disabled.value;\r\n      if (gestureDisabled.value) return;\r\n      panGestureState.value = evt.state;\r\n    })\r\n    .onUpdate((evt) => {\r\n      if (gestureDisabled.value) return;\r\n      panGestureState.value = evt.state;\r\n      const translation = horizontalAnim.value\r\n        ? evt.translationX\r\n        : evt.translationY;\r\n      touchTranslate.value = translation;\r\n    })\r\n    .onEnd((evt) => {\r\n      if (gestureDisabled.value) return;\r\n      // Set touch val to current translate val\r\n      isTouchActiveNative.value = false;\r\n      const translation = horizontalAnim.value\r\n        ? evt.translationX\r\n        : evt.translationY;\r\n\r\n      touchTranslate.value = translation + autoScrollDistance.value;\r\n      panGestureState.value = evt.state;\r\n\r\n      // Only call onDragEnd if actually dragging a cell\r\n      if (activeIndexAnim.value === -1 || disabled.value) return;\r\n      disabled.value = true;\r\n      runOnJS(onRelease)(activeIndexAnim.value);\r\n      const springTo = placeholderOffset.value - activeCellOffset.value;\r\n      touchTranslate.value = withSpring(\r\n        springTo,\r\n        animationConfigRef.current,\r\n        () => {\r\n          runOnJS(onDragEnd)({\r\n            from: activeIndexAnim.value,\r\n            to: spacerIndexAnim.value,\r\n          });\r\n          disabled.value = false;\r\n        }\r\n      );\r\n    })\r\n    .onTouchesDown(() => {\r\n      runOnJS(onContainerTouchStart)();\r\n    })\r\n    .onTouchesUp(() => {\r\n      // Turning this into a worklet causes timing issues. We want it to run\r\n      // just after the finger lifts.\r\n      runOnJS(onContainerTouchEnd)();\r\n    });\r\n\r\n  if (dragHitSlop) panGesture.hitSlop(dragHitSlop);\r\n  if (activationDistanceProp) {\r\n    const activeOffset = [-activationDistanceProp, activationDistanceProp];\r\n    if (props.horizontal) {\r\n      panGesture.activeOffsetX(activeOffset);\r\n    } else {\r\n      panGesture.activeOffsetY(activeOffset);\r\n    }\r\n  }\r\n\r\n  const onScroll = useStableCallback((scrollOffset: number) => {\r\n    props.onScrollOffsetChange?.(scrollOffset);\r\n  });\r\n\r\n  const scrollHandler = useAnimatedScrollHandler(\r\n    {\r\n      onScroll: (evt) => {\r\n        scrollOffset.value = horizontalAnim.value\r\n          ? evt.contentOffset.x\r\n          : evt.contentOffset.y;\r\n        runOnJS(onScroll)(scrollOffset.value);\r\n      },\r\n    },\r\n    [horizontalAnim]\r\n  );\r\n\r\n  useAutoScroll();\r\n\r\n  const onViewableItemsChanged = useStableCallback<\r\n    OnViewableItemsChangedCallback<T>\r\n  >((info) => {\r\n    const viewableIndices = info.viewableItems\r\n      .filter((item) => item.isViewable)\r\n      .map((item) => item.index)\r\n      .filter((index): index is number => typeof index === \"number\");\r\n\r\n    const min = Math.min(...viewableIndices);\r\n    const max = Math.max(...viewableIndices);\r\n    viewableIndexMin.value = min;\r\n    viewableIndexMax.value = max;\r\n    props.onViewableItemsChanged?.(info);\r\n  });\r\n\r\n  return (\r\n    <DraggableFlatListProvider\r\n      activeKey={activeKey}\r\n      keyExtractor={keyExtractor}\r\n      horizontal={!!props.horizontal}\r\n      layoutAnimationDisabled={layoutAnimationDisabled}\r\n    >\r\n      <GestureDetector gesture={panGesture}>\r\n        <Animated.View\r\n          style={props.containerStyle}\r\n          ref={containerRef}\r\n          onLayout={onContainerLayout}\r\n        >\r\n          {props.renderPlaceholder && (\r\n            <PlaceholderItem renderPlaceholder={props.renderPlaceholder} />\r\n          )}\r\n          <AnimatedFlatList\r\n            {...props}\r\n            data={props.data}\r\n            onViewableItemsChanged={onViewableItemsChanged}\r\n            CellRendererComponent={CellRendererComponent}\r\n            ref={flatlistRef}\r\n            onContentSizeChange={onListContentSizeChange}\r\n            scrollEnabled={!activeKey && scrollEnabled}\r\n            renderItem={renderItem}\r\n            extraData={extraData}\r\n            keyExtractor={keyExtractor}\r\n            onScroll={scrollHandler}\r\n            scrollEventThrottle={16}\r\n            simultaneousHandlers={props.simultaneousHandlers}\r\n            removeClippedSubviews={false}\r\n          />\r\n          {!!props.onScrollOffsetChange && (\r\n            <ScrollOffsetListener\r\n              onScrollOffsetChange={props.onScrollOffsetChange}\r\n              scrollOffset={scrollOffset}\r\n            />\r\n          )}\r\n        </Animated.View>\r\n      </GestureDetector>\r\n    </DraggableFlatListProvider>\r\n  );\r\n}\r\n\r\nfunction DraggableFlatList<T>(\r\n  props: DraggableFlatListProps<T>,\r\n  ref?: React.ForwardedRef<FlatList<T>> | null\r\n) {\r\n  return (\r\n    <PropsProvider {...props}>\r\n      <AnimatedValueProvider>\r\n        <RefProvider flatListRef={ref}>\r\n          <MemoizedInner {...props} />\r\n        </RefProvider>\r\n      </AnimatedValueProvider>\r\n    </PropsProvider>\r\n  );\r\n}\r\n\r\nconst MemoizedInner = typedMemo(DraggableFlatListInner);\r\n\r\n// Generic forwarded ref type assertion taken from:\r\n// https://fettblog.eu/typescript-react-generic-forward-refs/#option-1%3A-type-assertion\r\nexport default React.forwardRef(DraggableFlatList) as <T>(\r\n  props: DraggableFlatListProps<T> & { ref?: React.ForwardedRef<FlatList<T>> }\r\n) => ReturnType<typeof DraggableFlatList>;\r\n"],"mappings":"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"}