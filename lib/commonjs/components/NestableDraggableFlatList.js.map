{"version":3,"names":["NestableDraggableFlatListInner","props","ref","hasSuppressedWarnings","useRef","current","LogBox","ignoreLogs","console","reportErrorsAsExceptions","useSafeNestableScrollContainerContext","scrollableRef","outerScrollOffset","setOuterScrollEnabled","listVerticalOffset","useSharedValue","useState","animVals","setAnimVals","defaultHoverOffset","listHoverOffset","setListHoverOffset","hoverOffset","useDerivedValue","value","useNestedAutoScroll","onListContainerLayout","useStableCallback","containerRef","nodeHandle","findNodeHandle","onSuccess","_x","y","onFail","log","measureLayout","onDragBegin","params","onDragEnd","onAnimValInit","activationDistance","NestableDraggableFlatList","React","forwardRef"],"sources":["NestableDraggableFlatList.tsx"],"sourcesContent":["import React, { useRef, useState } from \"react\";\r\nimport { findNodeHandle, LogBox } from \"react-native\";\r\nimport Animated, {\r\n  useDerivedValue,\r\n  useSharedValue,\r\n} from \"react-native-reanimated\";\r\nimport { DraggableFlatListProps } from \"../types\";\r\nimport DraggableFlatList from \"../components/DraggableFlatList\";\r\nimport { useSafeNestableScrollContainerContext } from \"../context/nestableScrollContainerContext\";\r\nimport { useNestedAutoScroll } from \"../hooks/useNestedAutoScroll\";\r\nimport { typedMemo } from \"../utils\";\r\nimport { useStableCallback } from \"../hooks/useStableCallback\";\r\nimport { FlatList } from \"react-native-gesture-handler\";\r\n\r\nfunction NestableDraggableFlatListInner<T>(\r\n  props: DraggableFlatListProps<T>,\r\n  ref?: React.ForwardedRef<FlatList<T>>\r\n) {\r\n  const hasSuppressedWarnings = useRef(false);\r\n\r\n  if (!hasSuppressedWarnings.current) {\r\n    LogBox.ignoreLogs([\r\n      \"VirtualizedLists should never be nested inside plain ScrollViews with the same orientation because it can break windowing\",\r\n    ]); // Ignore log notification by message\r\n    //@ts-ignore\r\n    console.reportErrorsAsExceptions = false;\r\n    hasSuppressedWarnings.current = true;\r\n  }\r\n\r\n  const {\r\n    scrollableRef,\r\n    outerScrollOffset,\r\n    setOuterScrollEnabled,\r\n  } = useSafeNestableScrollContainerContext();\r\n\r\n  const listVerticalOffset = useSharedValue(0);\r\n  const [animVals, setAnimVals] = useState({});\r\n  const defaultHoverOffset = useSharedValue(0);\r\n  const [listHoverOffset, setListHoverOffset] = useState(defaultHoverOffset);\r\n\r\n  const hoverOffset = useDerivedValue(() => {\r\n    return listHoverOffset.value + listVerticalOffset.value;\r\n  }, [listHoverOffset]);\r\n\r\n  useNestedAutoScroll({\r\n    ...animVals,\r\n    hoverOffset,\r\n  });\r\n\r\n  const onListContainerLayout = useStableCallback(async ({ containerRef }) => {\r\n    const nodeHandle = findNodeHandle(scrollableRef.current);\r\n\r\n    const onSuccess = (_x: number, y: number) => {\r\n      listVerticalOffset.value = y;\r\n    };\r\n    const onFail = () => {\r\n      console.log(\"## nested draggable list measure fail\");\r\n    };\r\n    //@ts-ignore\r\n    containerRef.current.measureLayout(nodeHandle, onSuccess, onFail);\r\n  });\r\n\r\n  const onDragBegin: DraggableFlatListProps<T>[\"onDragBegin\"] = useStableCallback(\r\n    (params) => {\r\n      setOuterScrollEnabled(false);\r\n      props.onDragBegin?.(params);\r\n    }\r\n  );\r\n\r\n  const onDragEnd: DraggableFlatListProps<T>[\"onDragEnd\"] = useStableCallback(\r\n    (params) => {\r\n      setOuterScrollEnabled(true);\r\n      props.onDragEnd?.(params);\r\n    }\r\n  );\r\n\r\n  const onAnimValInit: DraggableFlatListProps<T>[\"onAnimValInit\"] = useStableCallback(\r\n    (params) => {\r\n      setListHoverOffset(params.hoverOffset);\r\n      setAnimVals({\r\n        ...params,\r\n        hoverOffset,\r\n      });\r\n      props.onAnimValInit?.(params);\r\n    }\r\n  );\r\n\r\n  return (\r\n    <DraggableFlatList\r\n      ref={ref}\r\n      onContainerLayout={onListContainerLayout}\r\n      activationDistance={props.activationDistance || 20}\r\n      scrollEnabled={false}\r\n      {...props}\r\n      outerScrollOffset={outerScrollOffset}\r\n      onDragBegin={onDragBegin}\r\n      onDragEnd={onDragEnd}\r\n      onAnimValInit={onAnimValInit}\r\n    />\r\n  );\r\n}\r\n\r\n// Generic forwarded ref type assertion taken from:\r\n// https://fettblog.eu/typescript-react-generic-forward-refs/#option-1%3A-type-assertion\r\nexport const NestableDraggableFlatList = React.forwardRef(\r\n  NestableDraggableFlatListInner\r\n) as <T>(\r\n  props: DraggableFlatListProps<T> & { ref?: React.ForwardedRef<FlatList<T>> }\r\n) => ReturnType<typeof NestableDraggableFlatListInner>;\r\n"],"mappings":"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"}