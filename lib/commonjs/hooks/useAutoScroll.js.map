{"version":3,"names":["useAutoScroll","useRefs","flatlistRef","useProps","autoscrollThreshold","DEFAULT_PROPS","autoscrollSpeed","useAnimatedValues","scrollOffset","scrollViewSize","containerSize","activeCellSize","hoverOffset","activeIndexAnim","hoverScreenOffset","useDerivedValue","value","isScrolledUp","SCROLL_POSITION_TOLERANCE","isScrolledDown","distToTopEdge","Math","max","distToBottomEdge","hoverPlusActiveCell","isAtTopEdge","isAtBottomEdge","scrollTarget","useSharedValue","dragIsActive","useAnimatedReaction","cur","prev","shouldAutoScroll","scrollTargetDiff","abs","hasScrolledToTarget","isAtEdge","topDisabled","bottomDisabled","isEdgeDisabled","cellIsActive","scrollToInternal","offset","current","scrollToOffset","animated","distFromEdge","speedPct","targetOffset","min","runOnJS"],"sources":["useAutoScroll.tsx"],"sourcesContent":["import {\r\n  runOnJS,\r\n  useAnimatedReaction,\r\n  useDerivedValue,\r\n  useSharedValue,\r\n} from \"react-native-reanimated\";\r\nimport { DEFAULT_PROPS, SCROLL_POSITION_TOLERANCE } from \"../constants\";\r\nimport { useProps } from \"../context/propsContext\";\r\nimport { useAnimatedValues } from \"../context/animatedValueContext\";\r\nimport { useRefs } from \"../context/refContext\";\r\n\r\nexport function useAutoScroll() {\r\n  const { flatlistRef } = useRefs();\r\n\r\n  const {\r\n    autoscrollThreshold = DEFAULT_PROPS.autoscrollThreshold,\r\n    autoscrollSpeed = DEFAULT_PROPS.autoscrollSpeed,\r\n  } = useProps();\r\n\r\n  const {\r\n    scrollOffset,\r\n    scrollViewSize,\r\n    containerSize,\r\n    activeCellSize,\r\n    hoverOffset,\r\n    activeIndexAnim,\r\n  } = useAnimatedValues();\r\n\r\n  const hoverScreenOffset = useDerivedValue(() => {\r\n    return hoverOffset.value - scrollOffset.value;\r\n  }, []);\r\n\r\n  const isScrolledUp = useDerivedValue(() => {\r\n    return scrollOffset.value - SCROLL_POSITION_TOLERANCE <= 0;\r\n  }, []);\r\n\r\n  const isScrolledDown = useDerivedValue(() => {\r\n    return (\r\n      scrollOffset.value + containerSize.value + SCROLL_POSITION_TOLERANCE >=\r\n      scrollViewSize.value\r\n    );\r\n  }, []);\r\n\r\n  const distToTopEdge = useDerivedValue(() => {\r\n    return Math.max(0, hoverScreenOffset.value);\r\n  }, []);\r\n\r\n  const distToBottomEdge = useDerivedValue(() => {\r\n    const hoverPlusActiveCell = hoverScreenOffset.value + activeCellSize.value;\r\n    return Math.max(0, containerSize.value - hoverPlusActiveCell);\r\n  }, []);\r\n\r\n  const isAtTopEdge = useDerivedValue(() => {\r\n    return distToTopEdge.value <= autoscrollThreshold;\r\n  });\r\n\r\n  const isAtBottomEdge = useDerivedValue(() => {\r\n    return distToBottomEdge.value <= autoscrollThreshold;\r\n  }, []);\r\n\r\n  const scrollTarget = useSharedValue(0);\r\n  const dragIsActive = useDerivedValue(() => {\r\n    return activeIndexAnim.value >= 0;\r\n  }, []);\r\n\r\n  useAnimatedReaction(\r\n    () => {\r\n      return dragIsActive.value;\r\n    },\r\n    (cur, prev) => {\r\n      if (cur && !prev) {\r\n        scrollTarget.value = scrollOffset.value;\r\n      }\r\n    }\r\n  );\r\n\r\n  const shouldAutoScroll = useDerivedValue(() => {\r\n    const scrollTargetDiff = Math.abs(scrollTarget.value - scrollOffset.value);\r\n    const hasScrolledToTarget = scrollTargetDiff < SCROLL_POSITION_TOLERANCE;\r\n\r\n    const isAtEdge = isAtTopEdge.value || isAtBottomEdge.value;\r\n    const topDisabled = isAtTopEdge.value && isScrolledUp.value;\r\n    const bottomDisabled = isAtBottomEdge.value && isScrolledDown.value;\r\n    const isEdgeDisabled = topDisabled || bottomDisabled;\r\n\r\n    const cellIsActive = activeIndexAnim.value >= 0;\r\n\r\n    return hasScrolledToTarget && isAtEdge && !isEdgeDisabled && cellIsActive;\r\n  }, []);\r\n\r\n  function scrollToInternal(offset: number) {\r\n    if (flatlistRef && \"current\" in flatlistRef) {\r\n      flatlistRef.current?.scrollToOffset({ offset, animated: true });\r\n    }\r\n  }\r\n\r\n  useDerivedValue(() => {\r\n    if (!shouldAutoScroll.value) return;\r\n\r\n    const distFromEdge = isAtTopEdge.value\r\n      ? distToTopEdge.value\r\n      : distToBottomEdge.value;\r\n    const speedPct = 1 - distFromEdge / autoscrollThreshold!;\r\n    const offset = speedPct * autoscrollSpeed;\r\n    const targetOffset = isAtTopEdge.value\r\n      ? Math.max(0, scrollOffset.value - offset)\r\n      : Math.min(\r\n          scrollOffset.value + offset,\r\n          scrollViewSize.value - containerSize.value\r\n        );\r\n\r\n    scrollTarget.value = targetOffset;\r\n    // Reanimated scrollTo is crashing on android. use 'regular' scrollTo until figured out.\r\n    // scrollTo(scrollViewRef, targetX, targetY, true);\r\n    runOnJS(scrollToInternal)(targetOffset);\r\n  }, []);\r\n\r\n  return null;\r\n}\r\n"],"mappings":"6FAAA,8DAMA,uCACA,qDACA,qEACA,iDAEO,QAASA,cAAT,EAAyB,cACN,GAAAC,mBAAA,GADM,CACtBC,WADsB,UACtBA,WADsB,eAM1B,GAAAC,sBAAA,GAN0B,iCAI5BC,mBAJ4B,CAI5BA,mBAJ4B,gCAINC,wBAAA,CAAcD,mBAJR,uDAK5BE,eAL4B,CAK5BA,eAL4B,gCAKVD,wBAAA,CAAcC,eALJ,8CAe1B,GAAAC,uCAAA,GAf0B,CAS5BC,YAT4B,oBAS5BA,YAT4B,CAU5BC,cAV4B,oBAU5BA,cAV4B,CAW5BC,aAX4B,oBAW5BA,aAX4B,CAY5BC,cAZ4B,oBAY5BA,cAZ4B,CAa5BC,WAb4B,oBAa5BA,WAb4B,CAc5BC,eAd4B,oBAc5BA,eAd4B,CAiB9B,GAAMC,kBAAiB,CAAG,GAAAC,sCAAA,iCAAsB,CAC9C,MAAOH,YAAW,CAACI,KAAZ,CAAoBR,YAAY,CAACQ,KAAxC,CACD,CAFyB,0BA1BnBJ,WA0BmB,cA1BCJ,YA0BD,6QAEvB,EAFuB,CAA1B,CAIA,GAAMS,aAAY,CAAG,GAAAF,sCAAA,iCAAsB,CACzC,MAAOP,aAAY,CAACQ,KAAb,CAAqBE,oCAArB,EAAkD,CAAzD,CACD,CAFoB,2BA9BdV,YA8Bc,2BA9BOU,oCA8BP,sSAElB,EAFkB,CAArB,CAIA,GAAMC,eAAc,CAAG,GAAAJ,sCAAA,iCAAsB,CAC3C,MACEP,aAAY,CAACQ,KAAb,CAAqBN,aAAa,CAACM,KAAnC,CAA2CE,oCAA3C,EACAT,cAAc,CAACO,KAFjB,CAID,CALsB,2BAlChBR,YAkCgB,eAlCKE,aAkCL,2BAlC2BQ,oCAkC3B,gBAlCwDT,cAkCxD,yWAKpB,EALoB,CAAvB,CAOA,GAAMW,cAAa,CAAG,GAAAL,sCAAA,iCAAsB,CAC1C,MAAOM,KAAI,CAACC,GAAL,CAAS,CAAT,CAAYR,iBAAiB,CAACE,KAA9B,CAAP,CACD,CAFqB,gCAzCHF,iBAyCG,oQAEnB,EAFmB,CAAtB,CAIA,GAAMS,iBAAgB,CAAG,GAAAR,sCAAA,iCAAsB,CAC7C,GAAMS,oBAAmB,CAAGV,iBAAiB,CAACE,KAAlB,CAA0BL,cAAc,CAACK,KAArE,CACA,MAAOK,KAAI,CAACC,GAAL,CAAS,CAAT,CAAYZ,aAAa,CAACM,KAAd,CAAsBQ,mBAAlC,CAAP,CACD,CAHwB,gCA7CGV,iBA6CH,gBA7C6BH,cA6C7B,eA5CND,aA4CM,yXAGtB,EAHsB,CAAzB,CAKA,GAAMe,YAAW,CAAG,GAAAV,sCAAA,iCAAsB,CACxC,MAAOK,cAAa,CAACJ,KAAd,EAAuBZ,mBAA9B,CACD,CAFmB,4BAlDbgB,aAkDa,qBAlDUhB,mBAkDV,wRAApB,CAIA,GAAMsB,eAAc,CAAG,GAAAX,sCAAA,iCAAsB,CAC3C,MAAOQ,iBAAgB,CAACP,KAAjB,EAA0BZ,mBAAjC,CACD,CAFsB,+BAtDhBmB,gBAsDgB,qBAtDUnB,mBAsDV,gSAEpB,EAFoB,CAAvB,CAIA,GAAMuB,aAAY,CAAG,GAAAC,qCAAA,EAAe,CAAf,CAArB,CACA,GAAMC,aAAY,CAAG,GAAAd,sCAAA,iCAAsB,CACzC,MAAOF,gBAAe,CAACG,KAAhB,EAAyB,CAAhC,CACD,CAFoB,8BA3DdH,eA2Dc,wPAElB,EAFkB,CAArB,CAIA,GAAAiB,0CAAA,iCACQ,CACJ,MAAOD,aAAY,CAACb,KAApB,CACD,CAHH,2BA/DOa,YA+DP,2QAIGE,GAJH,CAIQC,IAJR,CAIiB,CACb,GAAID,GAAG,EAAI,CAACC,IAAZ,CAAkB,CAChBL,YAAY,CAACX,KAAb,CAAqBR,YAAY,CAACQ,KAAlC,CACD,CACF,CARH,2BA9DEW,YA8DF,cA9DuBnB,YA8DvB,gSAWA,GAAMyB,iBAAgB,CAAG,GAAAlB,sCAAA,iCAAsB,CAC7C,GAAMmB,iBAAgB,CAAGb,IAAI,CAACc,GAAL,CAASR,YAAY,CAACX,KAAb,CAAqBR,YAAY,CAACQ,KAA3C,CAAzB,CACA,GAAMoB,oBAAmB,CAAGF,gBAAgB,CAAGhB,oCAA/C,CAEA,GAAMmB,SAAQ,CAAGZ,WAAW,CAACT,KAAZ,EAAqBU,cAAc,CAACV,KAArD,CACA,GAAMsB,YAAW,CAAGb,WAAW,CAACT,KAAZ,EAAqBC,YAAY,CAACD,KAAtD,CACA,GAAMuB,eAAc,CAAGb,cAAc,CAACV,KAAf,EAAwBG,cAAc,CAACH,KAA9D,CACA,GAAMwB,eAAc,CAAGF,WAAW,EAAIC,cAAtC,CAEA,GAAME,aAAY,CAAG5B,eAAe,CAACG,KAAhB,EAAyB,CAA9C,CAEA,MAAOoB,oBAAmB,EAAIC,QAAvB,EAAmC,CAACG,cAApC,EAAsDC,YAA7D,CACD,CAZwB,2BA1ESd,YA0ET,cA1E8BnB,YA0E9B,2BAzEsBU,oCAyEtB,aAvELO,WAuEK,gBAtEFC,cAsEE,cAvEgBT,YAuEhB,gBAtEsBE,cAsEtB,iBApEJN,eAoEI,8xBAYtB,EAZsB,CAAzB,CAcA,QAAS6B,iBAAT,CAA0BC,MAA1B,CAA0C,CACxC,GAAIzC,WAAW,EAAI,WAAaA,YAAhC,CAA6C,0BAC3C,sBAAAA,WAAW,CAAC0C,OAAZ,oCAAqBC,cAArB,CAAoC,CAAEF,MAAM,CAANA,MAAF,CAAUG,QAAQ,CAAE,IAApB,CAApC,EACD,CACF,CAED,GAAA/B,sCAAA,iCAAsB,CACpB,GAAI,CAACkB,gBAAgB,CAACjB,KAAtB,CAA6B,OAE7B,GAAM+B,aAAY,CAAGtB,WAAW,CAACT,KAAZ,CACjBI,aAAa,CAACJ,KADG,CAEjBO,gBAAgB,CAACP,KAFrB,CAGA,GAAMgC,SAAQ,CAAG,EAAID,YAAY,CAAG3C,mBAApC,CACA,GAAMuC,OAAM,CAAGK,QAAQ,CAAG1C,eAA1B,CACA,GAAM2C,aAAY,CAAGxB,WAAW,CAACT,KAAZ,CACjBK,IAAI,CAACC,GAAL,CAAS,CAAT,CAAYd,YAAY,CAACQ,KAAb,CAAqB2B,MAAjC,CADiB,CAEjBtB,IAAI,CAAC6B,GAAL,CACE1C,YAAY,CAACQ,KAAb,CAAqB2B,MADvB,CAEElC,cAAc,CAACO,KAAf,CAAuBN,aAAa,CAACM,KAFvC,CAFJ,CAOAW,YAAY,CAACX,KAAb,CAAqBiC,YAArB,CAGA,GAAAE,8BAAA,EAAQT,gBAAR,EAA0BO,YAA1B,EACD,CAnBD,+BA9FKhB,gBA8FL,aA1FqBR,WA0FrB,eA7FyCL,aA6FzC,kBA7F+DG,gBA6F/D,qBA5FoCnB,mBA4FpC,iBA3F0BE,eA2F1B,cA1F6FE,YA0F7F,gBA1F0HC,cA0F1H,eA1FiJC,aA0FjJ,cAzFAiB,YAyFA,SAtFAwB,8BAsFA,kBAtFQT,gBAsFR,iyBAmBG,EAnBH,EAqBA,MAAO,KAAP,CACD"}