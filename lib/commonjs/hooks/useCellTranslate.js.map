{"version":3,"names":["useCellTranslate","cellIndex","cellSize","cellOffset","useAnimatedValues","activeIndexAnim","activeCellSize","hoverOffset","spacerIndexAnim","placeholderOffset","hoverAnim","viewableIndexMin","viewableIndexMax","useDraggableFlatListContext","activeKey","useRefs","animationConfigRef","translate","useDerivedValue","isActiveCell","value","isOutsideViewableRange","isBeforeActive","isAfterActive","hoverPlusActiveSize","offsetPlusHalfSize","offsetPlusSize","result","newPlaceholderOffset","shouldTranslate","translationAmt","withSpring","current"],"sources":["useCellTranslate.tsx"],"sourcesContent":["import Animated, { useDerivedValue, withSpring } from \"react-native-reanimated\";\r\nimport { useAnimatedValues } from \"../context/animatedValueContext\";\r\nimport { useDraggableFlatListContext } from \"../context/draggableFlatListContext\";\r\nimport { useRefs } from \"../context/refContext\";\r\n\r\ntype Params = {\r\n  cellIndex: number;\r\n  cellSize: Animated.SharedValue<number>;\r\n  cellOffset: Animated.SharedValue<number>;\r\n};\r\n\r\nexport function useCellTranslate({ cellIndex, cellSize, cellOffset }: Params) {\r\n  const {\r\n    activeIndexAnim,\r\n    activeCellSize,\r\n    hoverOffset,\r\n    spacerIndexAnim,\r\n    placeholderOffset,\r\n    hoverAnim,\r\n    viewableIndexMin,\r\n    viewableIndexMax,\r\n  } = useAnimatedValues();\r\n\r\n  const { activeKey } = useDraggableFlatListContext();\r\n\r\n  const { animationConfigRef } = useRefs();\r\n\r\n  const translate = useDerivedValue(() => {\r\n    const isActiveCell = cellIndex === activeIndexAnim.value;\r\n    const isOutsideViewableRange =\r\n      !isActiveCell &&\r\n      (cellIndex < viewableIndexMin.value ||\r\n        cellIndex > viewableIndexMax.value);\r\n    if (!activeKey || activeIndexAnim.value < 0 || isOutsideViewableRange) {\r\n      return 0;\r\n    }\r\n\r\n    // Determining spacer index is hard to visualize. See diagram: https://i.imgur.com/jRPf5t3.jpg\r\n    const isBeforeActive = cellIndex < activeIndexAnim.value;\r\n    const isAfterActive = cellIndex > activeIndexAnim.value;\r\n\r\n    const hoverPlusActiveSize = hoverOffset.value + activeCellSize.value;\r\n    const offsetPlusHalfSize = cellOffset.value + cellSize.value / 2;\r\n    const offsetPlusSize = cellOffset.value + cellSize.value;\r\n    let result = -1;\r\n\r\n    if (isAfterActive) {\r\n      if (\r\n        hoverPlusActiveSize >= cellOffset.value &&\r\n        hoverPlusActiveSize < offsetPlusHalfSize\r\n      ) {\r\n        // bottom edge of active cell overlaps top half of current cell\r\n        result = cellIndex - 1;\r\n      } else if (\r\n        hoverPlusActiveSize >= offsetPlusHalfSize &&\r\n        hoverPlusActiveSize < offsetPlusSize\r\n      ) {\r\n        // bottom edge of active cell overlaps bottom half of current cell\r\n        result = cellIndex;\r\n      }\r\n    } else if (isBeforeActive) {\r\n      if (\r\n        hoverOffset.value < offsetPlusSize &&\r\n        hoverOffset.value >= offsetPlusHalfSize\r\n      ) {\r\n        // top edge of active cell overlaps bottom half of current cell\r\n        result = cellIndex + 1;\r\n      } else if (\r\n        hoverOffset.value >= cellOffset.value &&\r\n        hoverOffset.value < offsetPlusHalfSize\r\n      ) {\r\n        // top edge of active cell overlaps top half of current cell\r\n        result = cellIndex;\r\n      }\r\n    }\r\n\r\n    if (result !== -1 && result !== spacerIndexAnim.value) {\r\n      spacerIndexAnim.value = result;\r\n    }\r\n\r\n    if (spacerIndexAnim.value === cellIndex) {\r\n      const newPlaceholderOffset = isAfterActive\r\n        ? cellSize.value + (cellOffset.value - activeCellSize.value)\r\n        : cellOffset.value;\r\n      placeholderOffset.value = newPlaceholderOffset;\r\n    }\r\n\r\n    // Active cell follows touch\r\n    if (isActiveCell) {\r\n      return hoverAnim.value;\r\n    }\r\n\r\n    // Translate cell down if it is before active index and active cell has passed it.\r\n    // Translate cell up if it is after the active index and active cell has passed it.\r\n\r\n    const shouldTranslate = isAfterActive\r\n      ? cellIndex <= spacerIndexAnim.value\r\n      : cellIndex >= spacerIndexAnim.value;\r\n\r\n    const translationAmt = shouldTranslate\r\n      ? activeCellSize.value * (isAfterActive ? -1 : 1)\r\n      : 0;\r\n\r\n    return withSpring(translationAmt, animationConfigRef.current);\r\n  }, [activeKey, cellIndex]);\r\n\r\n  return translate;\r\n}\r\n"],"mappings":"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"}