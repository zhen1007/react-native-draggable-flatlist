{"version":3,"names":["AnimatedValueContext","React","createContext","undefined","AnimatedValueProvider","children","value","useSetupAnimatedValues","useAnimatedValues","useContext","Error","props","useProps","DEFAULT_VAL","useSharedValue","containerSize","scrollViewSize","panGestureState","GestureState","UNDETERMINED","touchTranslate","isTouchActiveNative","hasMoved","disabled","horizontalAnim","horizontal","activeIndexAnim","spacerIndexAnim","activeCellSize","activeCellOffset","scrollOffset","scrollInit","viewableIndexMin","viewableIndexMax","outerScrollOffset","outerScrollInit","useAnimatedReaction","cur","prev","placeholderOffset","isDraggingCell","useDerivedValue","autoScrollDistance","innerScrollDiff","outerScrollDiff","scrollDiff","touchPositionDiff","extraTranslate","touchPositionDiffConstrained","containerMinusActiveCell","offsetRelativeToScrollTop","constrained","Math","min","max","maxTranslateNegative","maxTranslatePositive","constrainedBase","dragItemOverflow","hoverAnim","hoverOffset","isHovering","resetTouchedCell","useCallback","useMemo","useEffect","onAnimValInit"],"sources":["animatedValueContext.tsx"],"sourcesContent":["import React, { useMemo, useEffect, useCallback, useContext } from \"react\";\r\nimport {\r\n  useAnimatedReaction,\r\n  useDerivedValue,\r\n  useSharedValue,\r\n} from \"react-native-reanimated\";\r\nimport { State as GestureState } from \"react-native-gesture-handler\";\r\nimport { useProps } from \"./propsContext\";\r\n\r\nconst AnimatedValueContext = React.createContext<\r\n  ReturnType<typeof useSetupAnimatedValues> | undefined\r\n>(undefined);\r\n\r\nexport default function AnimatedValueProvider({\r\n  children,\r\n}: {\r\n  children: React.ReactNode;\r\n}) {\r\n  const value = useSetupAnimatedValues();\r\n  return (\r\n    <AnimatedValueContext.Provider value={value}>\r\n      {children}\r\n    </AnimatedValueContext.Provider>\r\n  );\r\n}\r\n\r\nexport function useAnimatedValues() {\r\n  const value = useContext(AnimatedValueContext);\r\n  if (!value) {\r\n    throw new Error(\r\n      \"useAnimatedValues must be called from within AnimatedValueProvider!\"\r\n    );\r\n  }\r\n  return value;\r\n}\r\n\r\nfunction useSetupAnimatedValues<T>() {\r\n  const props = useProps<T>();\r\n\r\n  const DEFAULT_VAL = useSharedValue(0);\r\n\r\n  const containerSize = useSharedValue(0);\r\n  const scrollViewSize = useSharedValue(0);\r\n\r\n  const panGestureState = useSharedValue<GestureState>(\r\n    GestureState.UNDETERMINED\r\n  );\r\n  const touchTranslate = useSharedValue(0);\r\n\r\n  const isTouchActiveNative = useSharedValue(false);\r\n\r\n  const hasMoved = useSharedValue(0);\r\n  const disabled = useSharedValue(false);\r\n\r\n  const horizontalAnim = useSharedValue(!!props.horizontal);\r\n\r\n  const activeIndexAnim = useSharedValue(-1); // Index of hovering cell\r\n  const spacerIndexAnim = useSharedValue(-1); // Index of hovered-over cell\r\n\r\n  const activeCellSize = useSharedValue(0); // Height or width of acctive cell\r\n  const activeCellOffset = useSharedValue(0); // Distance between active cell and edge of container\r\n\r\n  const scrollOffset = useSharedValue(0);\r\n  const scrollInit = useSharedValue(0);\r\n\r\n  const viewableIndexMin = useSharedValue(0);\r\n  const viewableIndexMax = useSharedValue(0);\r\n\r\n  // If list is nested there may be an outer scrollview\r\n  const outerScrollOffset = props.outerScrollOffset || DEFAULT_VAL;\r\n  const outerScrollInit = useSharedValue(0);\r\n\r\n  useAnimatedReaction(\r\n    () => {\r\n      return activeIndexAnim.value;\r\n    },\r\n    (cur, prev) => {\r\n      if (cur !== prev && cur >= 0) {\r\n        scrollInit.value = scrollOffset.value;\r\n        outerScrollInit.value = outerScrollOffset.value;\r\n      }\r\n    },\r\n    [outerScrollOffset]\r\n  );\r\n\r\n  const placeholderOffset = useSharedValue(0);\r\n\r\n  const isDraggingCell = useDerivedValue(() => {\r\n    return isTouchActiveNative.value && activeIndexAnim.value >= 0;\r\n  }, []);\r\n\r\n  useAnimatedReaction(\r\n    () => {\r\n      return outerScrollOffset.value;\r\n    },\r\n    (cur, prev) => {\r\n      if (isDraggingCell.value) {\r\n        return;\r\n      }\r\n      outerScrollInit.value = cur;\r\n    },\r\n    [outerScrollInit, isDraggingCell]\r\n  );\r\n\r\n  const autoScrollDistance = useDerivedValue(() => {\r\n    if (!isDraggingCell.value) return 0;\r\n    const innerScrollDiff = scrollOffset.value - scrollInit.value;\r\n    // If list is nested there may be an outer scroll diff\r\n    const outerScrollDiff = outerScrollOffset.value - outerScrollInit.value;\r\n    const scrollDiff = innerScrollDiff + outerScrollDiff;\r\n    return scrollDiff;\r\n  }, []);\r\n\r\n  const touchPositionDiff = useDerivedValue(() => {\r\n    const extraTranslate = isTouchActiveNative.value\r\n      ? autoScrollDistance.value\r\n      : 0;\r\n    return touchTranslate.value + extraTranslate;\r\n  }, []);\r\n\r\n  const touchPositionDiffConstrained = useDerivedValue(() => {\r\n    const containerMinusActiveCell =\r\n      containerSize.value - activeCellSize.value + scrollOffset.value;\r\n\r\n    const offsetRelativeToScrollTop =\r\n      touchPositionDiff.value + activeCellOffset.value;\r\n    const constrained = Math.min(\r\n      containerMinusActiveCell,\r\n      Math.max(scrollOffset.value, offsetRelativeToScrollTop)\r\n    );\r\n\r\n    const maxTranslateNegative = -activeCellOffset.value;\r\n    const maxTranslatePositive =\r\n      scrollViewSize.value - (activeCellOffset.value + activeCellSize.value);\r\n\r\n    // Only constrain the touch position while the finger is on the screen. This allows the active cell\r\n    // to snap above/below the fold once let go, if the drag ends at the top/bottom of the screen.\r\n    const constrainedBase = isTouchActiveNative.value\r\n      ? constrained - activeCellOffset.value\r\n      : touchPositionDiff.value;\r\n\r\n    // Make sure item is constrained to the boundaries of the scrollview\r\n    return Math.min(\r\n      Math.max(constrainedBase, maxTranslateNegative),\r\n      maxTranslatePositive\r\n    );\r\n  }, []);\r\n\r\n  const dragItemOverflow = props.dragItemOverflow;\r\n  const hoverAnim = useDerivedValue(() => {\r\n    if (activeIndexAnim.value < 0) return 0;\r\n    return dragItemOverflow\r\n      ? touchPositionDiff.value\r\n      : touchPositionDiffConstrained.value;\r\n  }, []);\r\n\r\n  const hoverOffset = useDerivedValue(() => {\r\n    return hoverAnim.value + activeCellOffset.value;\r\n  }, [hoverAnim, activeCellOffset]);\r\n\r\n  useDerivedValue(() => {\r\n    // Reset spacer index when we stop hovering\r\n    const isHovering = activeIndexAnim.value >= 0;\r\n    if (!isHovering && spacerIndexAnim.value >= 0) {\r\n      spacerIndexAnim.value = -1;\r\n    }\r\n  }, []);\r\n\r\n  // Note: this could use a refactor as it combines touch state + cell animation\r\n  const resetTouchedCell = useCallback(() => {\r\n    activeCellOffset.value = 0;\r\n    hasMoved.value = 0;\r\n  }, []);\r\n\r\n  const value = useMemo(\r\n    () => ({\r\n      activeCellOffset,\r\n      activeCellSize,\r\n      activeIndexAnim,\r\n      containerSize,\r\n      disabled,\r\n      horizontalAnim,\r\n      hoverAnim,\r\n      hoverOffset,\r\n      isDraggingCell,\r\n      isTouchActiveNative,\r\n      panGestureState,\r\n      placeholderOffset,\r\n      resetTouchedCell,\r\n      scrollOffset,\r\n      scrollViewSize,\r\n      spacerIndexAnim,\r\n      touchPositionDiff,\r\n      touchTranslate,\r\n      autoScrollDistance,\r\n      viewableIndexMin,\r\n      viewableIndexMax,\r\n    }),\r\n    [\r\n      activeCellOffset,\r\n      activeCellSize,\r\n      activeIndexAnim,\r\n      containerSize,\r\n      disabled,\r\n      horizontalAnim,\r\n      hoverAnim,\r\n      hoverOffset,\r\n      isDraggingCell,\r\n      isTouchActiveNative,\r\n      panGestureState,\r\n      placeholderOffset,\r\n      resetTouchedCell,\r\n      scrollOffset,\r\n      scrollViewSize,\r\n      spacerIndexAnim,\r\n      touchPositionDiff,\r\n      touchTranslate,\r\n      autoScrollDistance,\r\n      viewableIndexMin,\r\n      viewableIndexMax,\r\n    ]\r\n  );\r\n\r\n  useEffect(() => {\r\n    props.onAnimValInit?.(value);\r\n  }, [value]);\r\n\r\n  return value;\r\n}\r\n"],"mappings":"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"}